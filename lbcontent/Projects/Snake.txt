3##STEP_1####INST_1##Game%20Flow%0A%0APlay%20the%20snake%20game%20for%2010%20minutes%20and%20think%20about%20its%20game%20flow.%0A%0A(*)*Tip:*%20Game%20flow%20is%20a%20collection%20of%20events%20that%20happen%20in%20the%20game,%20when%20described%20in%20a%20certain%20sequence%20explains%20how%20the%20game%20is%20played.##INST_1E####CODE_1####HTML##%3C!DOCTYPE%20html%3E%0D%0A%3Chtml%3E%0D%0A%0D%0A%3Chead%3E%0D%0A%20%20%20%20%3Clink%20rel=%22stylesheet%22%20href=%22style.css%22%20/%3E%0D%0A%20%20%20%20%3Clink%20href=%22https://fonts.googleapis.com/css?family=Nunito:200,400,700%22%20rel=%22stylesheet%22%3E%0D%0A%20%20%20%20%3Cscript%20src=%22script.js%22%3E%3C/script%3E%0D%0A%3C/head%3E%0D%0A%0D%0A%3Cbody%3E%0D%0A%0D%0A%20%20%20%20%3Ch1%3ESnake%20Game%3C/h1%3E%0D%0A%0D%0A%20%20%20%20%3Cdiv%20id=%22points-wrapper%22%3E%0D%0A%20%20%20%20%20%20%20%20%3Cp%20id=%22pointsLabel%22%3EPoints:%200%3C/p%3E%0D%0A%20%20%20%20%3C/div%3E%0D%0A%0D%0A%20%20%20%20%3Ccanvas%20id=%22gc%22%20width=%22400%22%20height=%22400%22%3E%3C/canvas%3E%0D%0A%0D%0A%20%20%20%20%3Cdiv%20id=%22button-wrapper%22%3E%0D%0A%0D%0A%20%20%20%20%20%20%20%20%3Cbutton%20id='playButton'%3EPlay%3C/button%3E%0D%0A%0D%0A%20%20%20%20%3C/div%3E%0D%0A%0D%0A%20%20%20%20%0D%0A%3C/body%3E%0D%0A%0D%0A%3C/html%3E#BEGIN_EDITABLE##END_EDITABLE###HTML_E####CSS##*%20%7B%0D%0A%20%20%20%20font-family:%20%22Nunito%22;%0D%0A%20%20%09text-align:%20center;%0D%0A%7D%0D%0A%0D%0Ah1%20%7B%0D%0A%20%20%20%20font-size:%2035px;%0D%0A%20%20%20%20font-weight:%20200;%0D%0A%7D%0D%0A%0D%0Ap%20%7B%0D%0A%20%20%20%20font-size:%2015;%0D%0A%20%20%20%20font-weight:%20700;%0D%0A%7D%0D%0A%0D%0Acanvas%20%7B%0D%0A%20%20%20%20padding-left:%200;%0D%0A%20%20%20%20padding-right:%200;%0D%0A%20%20%20%20margin-left:%20auto;%0D%0A%20%20%20%20margin-right:%20auto;%0D%0A%20%20%20%20display:%20block;%0D%0A%20%20%20%20width:%20400px;%0D%0A%7D%0D%0A%0D%0Abutton%20%7B%0D%0A%20%20%20%20font-size:%2014px;%0D%0A%20%20%20%20margin:%205px;%0D%0A%7D%0D%0A%0D%0A#points%20%7B%0D%0A%20%20%20%20text-align:%20right;%0D%0A%7D%0D%0A%0D%0A#points-wrapper%20%7B%0D%0A%20%20%20%20width:%20400px;%0D%0A%20%20%20%20margin:%20auto;%0D%0A%7D%0D%0A%0D%0A#button-wrapper%20%7B%0D%0A%20%20%20%20display:%20flex;%0D%0A%20%20%20%20align-items:%20center;%0D%0A%20%20%20%20justify-content:%20center;%0D%0A%7D%0D%0A%0D%0A#select-difficulty%20%7B%0D%0A%20%20%20%20margin-bottom:%200;%0D%0A%7D%0D%0A%0D%0A#playerLabel%20%7B%0D%0A%20%20%20%20margin-left:%205px;%0D%0A%20%20%20%20margin-right:%205px;%0D%0A%20%20%20%20font-weight:%20100;%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20The%20switch%20-%20the%20box%20around%20the%20slider%20*/%0D%0A%0D%0A.switch%20%7B%0D%0A%20%20%20%20position:%20relative;%0D%0A%20%20%20%20display:%20inline-block;%0D%0A%20%20%20%20width:%2050px;%0D%0A%20%20%20%20height:%2030px;%0D%0A%20%20%20%20margin-left:%205px;%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20Hide%20default%20HTML%20checkbox%20*/%0D%0A%0D%0A.switch%20input%20%7B%0D%0A%20%20%20%20display:%20none;%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20The%20slider%20*/%0D%0A%0D%0A.slider%20%7B%0D%0A%20%20%20%20position:%20absolute;%0D%0A%20%20%20%20cursor:%20pointer;%0D%0A%20%20%20%20top:%200;%0D%0A%20%20%20%20left:%200;%0D%0A%20%20%20%20right:%200;%0D%0A%20%20%20%20bottom:%200;%0D%0A%20%20%20%20background-color:%20#ccc;%0D%0A%20%20%20%20-webkit-transition:%20.4s;%0D%0A%20%20%20%20transition:%20.4s;%0D%0A%7D%0D%0A%0D%0A.slider:before%20%7B%0D%0A%20%20%20%20position:%20absolute;%0D%0A%20%20%20%20content:%20%22%22;%0D%0A%20%20%20%20height:%2022px;%0D%0A%20%20%20%20width:%2022px;%0D%0A%20%20%20%20left:%204px;%0D%0A%20%20%20%20bottom:%204px;%0D%0A%20%20%20%20background-color:%20white;%0D%0A%20%20%20%20-webkit-transition:%20.4s;%0D%0A%20%20%20%20transition:%20.4s;%0D%0A%7D%0D%0A%0D%0Ainput:checked+.slider%20%7B%0D%0A%20%20%20%20background-color:%20#2196F3;%0D%0A%7D%0D%0A%0D%0Ainput:focus+.slider%20%7B%0D%0A%20%20%20%20box-shadow:%200%200%201px%20#2196F3;%0D%0A%7D%0D%0A%0D%0Ainput:checked+.slider:before%20%7B%0D%0A%20%20%20%20-webkit-transform:%20translateX(22px);%0D%0A%20%20%20%20-ms-transform:%20translateX(20px);%0D%0A%20%20%20%20transform:%20translateX(20px);%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20Rounded%20sliders%20*/%0D%0A%0D%0A.slider.round%20%7B%0D%0A%20%20%20%20border-radius:%2020px;%0D%0A%7D%0D%0A%0D%0A.slider.round:before%20%7B%0D%0A%20%20%20%20border-radius:%2050%25;%0D%0A%7D#BEGIN_EDITABLE##END_EDITABLE###CSS_E####JS##//%20Segment%20types%20of%20the%20snake%0D%0Alet%20SegmentType%20=%20Object.freeze(%7B%20'head':%201,%20'body':%202,%20'tail':%203%20%7D);%0D%0A//%20Directions%20the%20snake%20can%20travel%0D%0Alet%20Direction%20=%20Object.freeze(%7B%20'up':%20%7B%20'x':%200,%20'y':%20-1%20%7D,%20'down':%20%7B%20'x':%200,%20'y':%201%20%7D,%20'right':%20%7B%20'x':%201,%20'y':%200%20%7D,%20'left':%20%7B%20'x':%20-1,%20'y':%200%20%7D%20%7D);%0D%0A%0D%0A//%20Array%20of%20the%20snakes%20playing%20the%20game%0D%0Alet%20snakes%20=%20%5B%5D;%0D%0A%0D%0A//%20Array%20of%20obstacles%20for%20the%20current%20game%20mode%0D%0Alet%20obstacles%20=%20%5B%5D;%0D%0A%0D%0A//%20The%20current%20apple%20on%20the%20screen%0D%0Alet%20apple;%0D%0A%0D%0A//%20How%20big%20each%20grid%20is%20(px)%0D%0Alet%20gridSize%20=%2020;%0D%0A//%20How%20many%20grids%20are%20in%20the%20canvas%0D%0Alet%20tileCount%20=%2020;%0D%0A//%20How%20many%20times%20the%20scene%20is%20redrawn,%20per%20second%0D%0Alet%20refreshRate%20=%208;%0D%0A%0D%0A//%20Boolean%20indicating%20whether%20the%20game%20is%20currently%20in%20progress%0D%0Alet%20gameHasStarted%20=%20false;%0D%0A%0D%0A//%20Define%20the%20function%20to%20be%20called%20when%20the%20window%20loads%0D%0Awindow.onload%20=%20function%20()%20%7B%0D%0A%0D%0A%20%20%20%20//%20Set%20up%20the%20graphics%0D%0A%20%20%09gc.width%20=%20tileCount%20*%20gridSize;%0D%0A%20%20%09gc.height%20=%20tileCount%20*%20gridSize;%0D%0A%20%20%20%20ctx%20=%20gc.getContext('2d');%0D%0A%09%0D%0A%20%20%20%20//%20Draw%20the%20opening%20screen%0D%0A%20%20%20%20drawStartingScreen();%0D%0A%20%20%0D%0A%20%20%09//%20Add%20listener%20for%20key%20presses%0D%0A%20%20%20%20document.addEventListener('keydown',%20keyPush);%0D%0A%20%20%09playButton.addEventListener('click',%20startGame);%0D%0A%0D%0A%7D;%0D%0A%0D%0A//%20Function:%20starting%20the%20game%20(canvas%20starts%20to%20refresh)%0D%0Afunction%20startGame()%20%7B%0D%0A%0D%0A%20%20%20%20gameHasStarted%20=%20true;%0D%0A%0D%0A%20%20%20%20//%20Create%20how%20many%20snakes%20you%20want%0D%0A%20%20%20%20createSnakes();%0D%0A%0D%0A%20%20%20%20//%20Randomize%20the%20location%20of%20the%20starting%20apple%0D%0A%20%20%20%20spawnNewApple();%0D%0A%0D%0A%20%20%20%20//%20Start%20the%20graphics,%20at%20a%2015%20refreshes%20per%20second%20rate%0D%0A%20%20%20%20window.refresher%20=%20setInterval(refreshGame,%201000%20/%20refreshRate);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20createSnakes()%20%7B%0D%0A%0D%0A%20%20%20%20snakes%20=%20%5B%5D;%0D%0A%0D%0A%20%20%20%20const%20snake1%20=%20new%20Snake(1,%209,%20'green');%0D%0A%20%20%20%20snakes.push(snake1);%0D%0A%0D%0A%7D%0D%0A%0D%0A//%20Function:%20called%20multiple%20times%20a%20second%20to%20refresh%20the%20canvas%0D%0Afunction%20refreshGame()%20%7B%0D%0A%0D%0A%20%20%20%20clearCanvas();%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20apple%0D%0A%20%20%20%20apple.draw(ctx);%0D%0A%0D%0A%20%20%20%20refreshSnakes();%0D%0A%0D%0A%20%20%20%20//%20Check%20if%20snakes%20have%20run%20into%20each%20other%0D%0A%20%20%20%20checkForSnakeCollision();%0D%0A%0D%0A%20%20%20%20updatePointsLabel();%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20refreshSnakes()%20%7B%0D%0A%0D%0A%20%20%20%20//%20If%20any%20snake%20draw%20fails,%20stop%20all%20drawing%0D%0A%20%20%20%20snakes.every(snake%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20if%20(snake.draw(ctx))%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20snake.checkForApple();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%0D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%7D);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20checkForSnakeCollision()%20%7B%0D%0A%0D%0A%20%20%20%20let%20losingSnakes%20=%20%5B%5D;%0D%0A%20%20%20%20snakes.forEach(snake%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20if%20(snake.checkForSnakeCollision())%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20losingSnakes.push(snake);%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20if%20(losingSnakes.length)%20%7B%0D%0A%20%20%20%20%20%20%20%20playerLoses(losingSnakes);%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D%0D%0A%0D%0A//%20Function:%20resetting%20the%20game%20(if%20the%20player%20dies)%0D%0Afunction%20resetGame()%20%7B%0D%0A%0D%0A%20%20%20%20player1Name%20=%20null;%0D%0A%20%20%20%20player2Name%20=%20null;%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20starting%20snake%20screen%0D%0A%20%20%20%20drawStartingScreen();%0D%0A%0D%0A%20%20%20%20updatePointsLabel();%0D%0A%7D%0D%0A%0D%0A//%20Function:%20handles%20the%20playing-losing%20event%0D%0Afunction%20playerLoses(losingSnakes)%20%7B%0D%0A%0D%0A%20%20%20%20gameHasStarted%20=%20false;%0D%0A%0D%0A%20%20%20%20//%20Stop%20the%20canvas%20from%20refreshing%0D%0A%20%20%20%20clearInterval(window.refresher);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20screen%20showing%20the%20%22L%22%20snake%0D%0A%20%20%20%20drawLosingScreen();%0D%0A%0D%0A%20%20%20%20//%20Wait%203%20seconds,%20and%20then%20reset%20the%20game%0D%0A%20%20%20%20setTimeout(resetGame,%203000);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20spawnNewApple()%20%7B%0D%0A%20%20%20%20apple%20=%20new%20Apple();%0D%0A%7D%0D%0A%0D%0Afunction%20clearCanvas()%20%7B%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(0,%200,%20gc.width,%20gc.height);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20updatePointsLabel()%20%7B%0D%0A%20%20%20%20pointsLabel.innerHTML%20=%20gameHasStarted%20?%20'Points:%20'%20+%20String(snakes%5B0%5D.points)%20:%20'Points:%200';%0D%0A%7D%0D%0A%0D%0Afunction%20keyPush(evt)%20%7B%0D%0A%20%20%20%20%0D%0A%20%20%20%20if%20(!gameHasStarted)%20%7B%0D%0A%20%20%20%20%20%20%20%20return;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20evt.preventDefault();%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2065)%20snakes%5B0%5D.setDirection(Direction.left);%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2087)%20snakes%5B0%5D.setDirection(Direction.up);%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2068)%20snakes%5B0%5D.setDirection(Direction.right);%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2083)%20snakes%5B0%5D.setDirection(Direction.down);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20drawLosingScreen()%20%7B%0D%0A%0D%0A%20%20%20%20clearCanvas();%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(0,%200,%20gc.width,%20gc.height);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'green';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize,%203%20*%20gridSize,%208%20*%20gridSize,%2014%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(8%20*%20gridSize,%203%20*%20gridSize,%206%20*%20gridSize,%2012%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20triangle%20tail%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(13%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(13%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20eyes%0D%0A%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%203%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%20%20%20%20ctx.fillRect(7%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%203%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20tongue%0D%0A%20%20%20%20ctx.fillStyle%20=%20'pink';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize%20+%205%20/%206%20*%20gridSize,%202.5%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%202%20*%20gridSize);%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7%20*%20gridSize,%202%20*%20gridSize%20+%203%20/%208%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6.5%20*%20gridSize,%202%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize%20+%205%20/%206%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7%20*%20gridSize,%202%20*%20gridSize%20+%203%20/%208%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7.5%20*%20gridSize,%202%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7%20*%20gridSize%20+%201%20/%206%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20drawStartingScreen()%20%7B%0D%0A%0D%0A%20%20%20%20clearCanvas();%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(0,%200,%20gc.width,%20gc.height);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'green';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize,%203%20*%20gridSize,%208%20*%20gridSize,%2014%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(8%20*%20gridSize,%205%20*%20gridSize,%206%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize,%2011%20*%20gridSize,%206%20*%20gridSize,%204%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20triangle%20tail%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20eyes%0D%0A%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20ctx.fillRect(13%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%203%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%20%20%20%20ctx.fillRect(13%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%204%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20tongue%0D%0A%20%20%20%20ctx.fillStyle%20=%20'pink';%0D%0A%20%20%20%20ctx.fillRect(14%20*%20gridSize,%203%20*%20gridSize%20+%205%20/%206%20*%20gridSize,%201%20/%202%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(14.5%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize%20+%205%20/%208%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(15%20*%20gridSize,%203.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14.5%20*%20gridSize,%203%20*%20gridSize%20+%205%20/%206%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(14.5%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize%20+%205%20/%208%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(15%20*%20gridSize,%204.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14.5%20*%20gridSize,%204%20*%20gridSize%20+%201%20/%206%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%7D%0D%0A%0D%0Aclass%20Snake%20%7B%0D%0A%0D%0A%20%20%20%20constructor(x,%20y,%20color,%20name%20=%20'Snakey')%20%7B%0D%0A%20%20%20%20%20%20%20%20//%20An%20array%20of%20SnakeSegments%0D%0A%20%20%20%20%20%20%20%20this.segments%20=%20%5B%5D;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.color%20=%20color;%0D%0A%20%20%20%20%20%20%20%20this.altColor%20=%20color;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.name%20=%20name;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.direction%20=%20Direction.up;%0D%0A%20%20%20%20%20%20%20%20this.pendingTurn%20=%20false;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Coordinates%20of%20the%20head%20of%20the%20snake%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20x;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.prevTailPos%20=%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20x:%200,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20y:%200%0D%0A%20%20%20%20%20%20%20%20%7D;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.points%20=%200;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.generateSnake();%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20generateSnake()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Create%20the%20initial%20snake%0D%0A%20%20%20%20%20%20%20%20const%20startSize%20=%205;%0D%0A%20%20%20%20%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%20startSize;%20i++)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20segment;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!i)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20segment%20=%20new%20SnakeSegment(this.x,%20this.y,%20this.color,%20SegmentType.head);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(i%20===%20startSize%20-%201)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20segment%20=%20new%20SnakeSegment(this.x,%20this.y,%20this.color,%20SegmentType.tail);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20segment%20=%20new%20SnakeSegment(this.x,%20this.y,%20this.color,%20SegmentType.body);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.segments.push(segment);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20drawSnakeTail()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20tail%20=%20this.tail;%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20preTail%20=%20this.getSegment(this.segments.length%20-%202);%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Get%20the%20direction%20that%20the%20tail%20is%20moving%20in%0D%0A%20%20%20%20%20%20%20%20let%20tailXVelocity%20=%20preTail.position.x%20-%20tail.position.x;%0D%0A%20%20%20%20%20%20%20%20let%20tailYVelocity%20=%20preTail.position.y%20-%20tail.position.y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20switch%20(tailXVelocity)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize%20+%209);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize%20+%209);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%200:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(tailYVelocity)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%209,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%209,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20drawSnakeEyes()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20head%20=%20this.head;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Giving%20the%20snake%20eyes%20based%20off%20of%20its%20direction%0D%0A%20%20%20%20%20%20%20%20switch%20(this.direction.x)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2012,%20head.position.y%20*%20gridSize%20+%203,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2012,%20head.position.y%20*%20gridSize%20+%2011,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%202,%20head.position.y%20*%20gridSize%20+%203,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%202,%20head.position.y%20*%20gridSize%20+%2011,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%200:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(this.direction.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%203,%20head.position.y%20*%20gridSize%20+%2012,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2011,%20head.position.y%20*%20gridSize%20+%2012,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%203,%20head.position.y%20*%20gridSize%20+%202,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2011,%20head.position.y%20*%20gridSize%20+%202,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20this.color;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20//%20Called%20to%20draw%20the%20entire%20snake%0D%0A%20%20%20%20draw(ctx)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20this.color;%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20success%20=%20this.updatePositions();%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(!success)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%20this.segments.length;%20i++)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20drawing%20the%20tail%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20==%20this.segments.length%20-%201)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.drawSnakeTail();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(this.segments%5Bi%5D.x%20*%20gridSize,%20this.segments%5Bi%5D.y%20*%20gridSize,%20gridSize%20-%202,%20gridSize%20-%202);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20drawing%20the%20head%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!i)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.drawSnakeEyes();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20return%20true;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20updatePositions()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.pendingTurn%20=%20false;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Expressions%20account%20for%20vertical%20and%20horizontal%20wrapping%0D%0A%20%20%20%20%20%20%20%20const%20newX%20=%20this.x%20+%20this.direction.x%20%3E%20tileCount%20-%201%20?%200%20:%20(this.x%20+%20this.direction.x%20%3C%200%20?%20tileCount%20-%201%20:%20this.x%20+%20this.direction.x);%0D%0A%20%20%20%20%20%20%20%20const%20newY%20=%20this.y%20+%20this.direction.y%20%3E%20tileCount%20-%201%20?%200%20:%20(this.y%20+%20this.direction.y%20%3C%200%20?%20tileCount%20-%201%20:%20this.y%20+%20this.direction.y);%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20newX;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20newY;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Check%20if%20the%20snake%20ran%20into%20an%20obstacle%0D%0A%20%20%20%20%20%20%20%20const%20collision%20=%20obstacles.some(obstacle%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20obstacle.isCollision(this.x,%20this.y);%0D%0A%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(collision)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20playerLoses(%5Bthis%5D);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Go%20through%20the%20segments%20from%20the%20tail%20to%20the%20head,%20assigning%20each%20segment's%20x%20and%20y%20equal%20to%20the%20next%20segment's%20position%0D%0A%20%20%20%20%20%20%20%20for%20(let%20i%20=%20this.segments.length%20-%201;%20i%20%3E=%200;%20i--)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!i)%20%7B%20//%20For%20the%20head%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.segments%5Bi%5D.setPosition(this.x,%20this.y);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20===%20this.segments.length%20-%201)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.prevTailPos%20=%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x:%20this.segments%5Bi%5D.x,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y:%20this.segments%5Bi%5D.y%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20nextX%20=%20this.segments%5Bi%20-%201%5D.x;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20nextY%20=%20this.segments%5Bi%20-%201%5D.y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(nextX%20===%20this.x%20&&%20nextY%20===%20this.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20playerLoses(this);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.segments%5Bi%5D.setPosition(nextX,%20nextY);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20return%20true;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20checkForApple()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(this.x%20===%20apple.position.x%20&&%20this.y%20===%20apple.position.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%09this.points++;%0D%0A%20%20%20%20%20%20%20%20%20%20%09this.addSegment();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20spawnNewApple();%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20//%20Checks%20if%20this%20snake%20has%20run%20into%20any%20other%20snake%0D%0A%20%20%20%20checkForSnakeCollision()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20return%20snakes.some(snake%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(snake%20!==%20this)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20snake.segments.some(segment%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(segment.position.x%20===%20this.x%20&&%20segment.position.y%20===%20this.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20addSegment()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20tailSegment%20=%20this.segments%5Bthis.segments.length%20-%201%5D;%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20newSegment%20=%20new%20SnakeSegment(tailSegment.position.x,%20tailSegment.position.y,%20this.color,%20SegmentType.body);%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.segments.splice(this.segments.length%20-%201,%200,%20newSegment);%0D%0A%0D%0A%20%20%20%20%20%20%20%20tailSegment.setPosition(this.prevTailPos.x,%20this.prevTailPos.y);%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20setDirection(direction)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(this.pendingTurn)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.pendingTurn%20=%20true;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20To%20prevent%20180%20degree%20turns%0D%0A%20%20%20%20%20%20%20%20switch%20(direction)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.up:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.down)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.down:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.up)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.left:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.right)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.right:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.left)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.direction%20=%20direction;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20head()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20this.segments%5B0%5D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20tail()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20this.segments%5Bthis.segments.length%20-%201%5D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20getSegment(i)%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20this.segments%5Bi%5D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D%0D%0A%0D%0Aclass%20SnakeSegment%20%7B%0D%0A%0D%0A%20%20%20%20constructor(x,%20y,%20color,%20type)%20%7B%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20x;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.color%20=%20color;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20SegmentType%0D%0A%20%20%20%20%20%20%20%20this.type%20=%20type;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20setPosition(x,%20y)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20x;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20y;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20position()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20x:%20this.x,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20y:%20this.y%0D%0A%20%20%20%20%20%20%20%20%7D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D%0D%0A%0D%0Aclass%20Apple%20%7B%0D%0A%0D%0A%20%20%20%20constructor()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.x%20=%200;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%200;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.initPosition();%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20initPosition()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20let%20collision%20=%20false;%0D%0A%20%20%20%20%20%20%20%20do%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.x%20=%20Math.floor(Math.random()%20*%20tileCount);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.y%20=%20Math.floor(Math.random()%20*%20tileCount);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20collision%20=%20obstacles.some(obstacle%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obstacle.isCollision(this.x,%20this.y);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%20while%20(collision);%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20draw(ctx)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Draw%20apple%0D%0A%20%20%20%20%20%20%20%20if%20(this.gold)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'gold';%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'red';%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20ctx.arc(this.x%20*%20gridSize%20+%200.5%20*%20(gridSize%20-%202),%20this.y%20*%20gridSize%20+%200.5%20*%20(gridSize%20-%202),%200.4%20*%20(gridSize%20-%202),%200,%202%20*%20Math.PI);%0D%0A%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Draw%20stem%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'brown';%0D%0A%20%20%20%20%20%20%20%20ctx.fillRect(this.x%20*%20gridSize%20+%207,%20this.y%20*%20gridSize,%204,%200.5%20*%20(gridSize%20-%202));%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Draw%20leaf%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'green';%0D%0A%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20ctx.moveTo(this.x%20*%20gridSize%20+%209,%20this.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20ctx.lineTo(this.x%20*%20gridSize%20+%209,%20this.y%20*%20gridSize%20+%204);%0D%0A%20%20%20%20%20%20%20%20ctx.lineTo(this.x%20*%20gridSize%20+%2018,%20this.y%20*%20gridSize%20+%202);%0D%0A%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20position()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20x:%20this.x,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20y:%20this.y%0D%0A%20%20%20%20%20%20%20%20%7D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D#BEGIN_EDITABLE##END_EDITABLE###JS_E####CODE_1E####LOGIC_1####HTML####HTML_E####CSS####CSS_E####JS####JS_E####LOGIC_1E####STEP_1E####STEP_2####INST_2##Generic%0A%0AParagraph%0A%0AParagraph%0A%0A(***)%0A%0A(!)On%20+type#key#,%20objective##INST_2E####CODE_2####HTML##%3C!DOCTYPE%20html%3E%0D%0A%3Chtml%3E%0D%0A%0D%0A%3Chead%3E%0D%0A%20%20%20%20%3Clink%20rel=%22stylesheet%22%20href=%22style.css%22%20/%3E%0D%0A%20%20%20%20%3Clink%20href=%22https://fonts.googleapis.com/css?family=Nunito:200,400,700%22%20rel=%22stylesheet%22%3E%0D%0A%20%20%20%20%3Cscript%20src=%22script.js%22%3E%3C/script%3E%0D%0A%3C/head%3E%0D%0A%0D%0A%3Cbody%3E%0D%0A%0D%0A%20%20%20%20%3Ch1%3ESnake%20Game%3C/h1%3E%0D%0A%0D%0A%20%20%20%20%3Cdiv%20id=%22points-wrapper%22%3E%0D%0A%20%20%20%20%20%20%20%20%3Cp%20id=%22pointsLabel%22%3EPoints:%200%3C/p%3E%0D%0A%20%20%20%20%3C/div%3E%0D%0A%0D%0A%20%20%20%20%3Ccanvas%20id=%22gc%22%20width=%22400%22%20height=%22400%22%3E%3C/canvas%3E%0D%0A%0D%0A%20%20%20%20%3Cdiv%20id=%22button-wrapper%22%3E%0D%0A%0D%0A%20%20%20%20%20%20%20%20%3Cbutton%20id='playButton'%3EPlay%3C/button%3E%0D%0A%0D%0A%20%20%20%20%3C/div%3E%0D%0A%0D%0A%20%20%20%20%0D%0A%3C/body%3E%0D%0A%0D%0A%3C/html%3E#BEGIN_EDITABLE##END_EDITABLE###HTML_E####CSS##*%20%7B%0D%0A%20%20%20%20font-family:%20%22Nunito%22;%0D%0A%20%20%09text-align:%20center;%0D%0A%7D%0D%0A%0D%0Ah1%20%7B%0D%0A%20%20%20%20font-size:%2035px;%0D%0A%20%20%20%20font-weight:%20200;%0D%0A%7D%0D%0A%0D%0Ap%20%7B%0D%0A%20%20%20%20font-size:%2015;%0D%0A%20%20%20%20font-weight:%20700;%0D%0A%7D%0D%0A%0D%0Acanvas%20%7B%0D%0A%20%20%20%20padding-left:%200;%0D%0A%20%20%20%20padding-right:%200;%0D%0A%20%20%20%20margin-left:%20auto;%0D%0A%20%20%20%20margin-right:%20auto;%0D%0A%20%20%20%20display:%20block;%0D%0A%20%20%20%20width:%20400px;%0D%0A%7D%0D%0A%0D%0Abutton%20%7B%0D%0A%20%20%20%20font-size:%2014px;%0D%0A%20%20%20%20margin:%205px;%0D%0A%7D%0D%0A%0D%0A#points%20%7B%0D%0A%20%20%20%20text-align:%20right;%0D%0A%7D%0D%0A%0D%0A#points-wrapper%20%7B%0D%0A%20%20%20%20width:%20400px;%0D%0A%20%20%20%20margin:%20auto;%0D%0A%7D%0D%0A%0D%0A#button-wrapper%20%7B%0D%0A%20%20%20%20display:%20flex;%0D%0A%20%20%20%20align-items:%20center;%0D%0A%20%20%20%20justify-content:%20center;%0D%0A%7D%0D%0A%0D%0A#select-difficulty%20%7B%0D%0A%20%20%20%20margin-bottom:%200;%0D%0A%7D%0D%0A%0D%0A#playerLabel%20%7B%0D%0A%20%20%20%20margin-left:%205px;%0D%0A%20%20%20%20margin-right:%205px;%0D%0A%20%20%20%20font-weight:%20100;%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20The%20switch%20-%20the%20box%20around%20the%20slider%20*/%0D%0A%0D%0A.switch%20%7B%0D%0A%20%20%20%20position:%20relative;%0D%0A%20%20%20%20display:%20inline-block;%0D%0A%20%20%20%20width:%2050px;%0D%0A%20%20%20%20height:%2030px;%0D%0A%20%20%20%20margin-left:%205px;%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20Hide%20default%20HTML%20checkbox%20*/%0D%0A%0D%0A.switch%20input%20%7B%0D%0A%20%20%20%20display:%20none;%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20The%20slider%20*/%0D%0A%0D%0A.slider%20%7B%0D%0A%20%20%20%20position:%20absolute;%0D%0A%20%20%20%20cursor:%20pointer;%0D%0A%20%20%20%20top:%200;%0D%0A%20%20%20%20left:%200;%0D%0A%20%20%20%20right:%200;%0D%0A%20%20%20%20bottom:%200;%0D%0A%20%20%20%20background-color:%20#ccc;%0D%0A%20%20%20%20-webkit-transition:%20.4s;%0D%0A%20%20%20%20transition:%20.4s;%0D%0A%7D%0D%0A%0D%0A.slider:before%20%7B%0D%0A%20%20%20%20position:%20absolute;%0D%0A%20%20%20%20content:%20%22%22;%0D%0A%20%20%20%20height:%2022px;%0D%0A%20%20%20%20width:%2022px;%0D%0A%20%20%20%20left:%204px;%0D%0A%20%20%20%20bottom:%204px;%0D%0A%20%20%20%20background-color:%20white;%0D%0A%20%20%20%20-webkit-transition:%20.4s;%0D%0A%20%20%20%20transition:%20.4s;%0D%0A%7D%0D%0A%0D%0Ainput:checked+.slider%20%7B%0D%0A%20%20%20%20background-color:%20#2196F3;%0D%0A%7D%0D%0A%0D%0Ainput:focus+.slider%20%7B%0D%0A%20%20%20%20box-shadow:%200%200%201px%20#2196F3;%0D%0A%7D%0D%0A%0D%0Ainput:checked+.slider:before%20%7B%0D%0A%20%20%20%20-webkit-transform:%20translateX(22px);%0D%0A%20%20%20%20-ms-transform:%20translateX(20px);%0D%0A%20%20%20%20transform:%20translateX(20px);%0D%0A%7D%0D%0A%0D%0A%0D%0A/*%20Rounded%20sliders%20*/%0D%0A%0D%0A.slider.round%20%7B%0D%0A%20%20%20%20border-radius:%2020px;%0D%0A%7D%0D%0A%0D%0A.slider.round:before%20%7B%0D%0A%20%20%20%20border-radius:%2050%25;%0D%0A%7D#BEGIN_EDITABLE##END_EDITABLE###CSS_E####JS##//%20Segment%20types%20of%20the%20snake%0D%0Alet%20SegmentType%20=%20Object.freeze(%7B%20'head':%201,%20'body':%202,%20'tail':%203%20%7D);%0D%0A//%20Directions%20the%20snake%20can%20travel%0D%0Alet%20Direction%20=%20Object.freeze(%7B%20'up':%20%7B%20'x':%200,%20'y':%20-1%20%7D,%20'down':%20%7B%20'x':%200,%20'y':%201%20%7D,%20'right':%20%7B%20'x':%201,%20'y':%200%20%7D,%20'left':%20%7B%20'x':%20-1,%20'y':%200%20%7D%20%7D);%0D%0A%0D%0A//%20Array%20of%20the%20snakes%20playing%20the%20game%0D%0Alet%20snakes%20=%20%5B%5D;%0D%0A%0D%0A//%20Array%20of%20obstacles%20for%20the%20current%20game%20mode%0D%0Alet%20obstacles%20=%20%5B%5D;%0D%0A%0D%0A//%20The%20current%20apple%20on%20the%20screen%0D%0Alet%20apple;%0D%0A%0D%0A//%20How%20big%20each%20grid%20is%20(px)%0D%0Alet%20gridSize%20=%2020;%0D%0A//%20How%20many%20grids%20are%20in%20the%20canvas%0D%0Alet%20tileCount%20=%2020;%0D%0A//%20How%20many%20times%20the%20scene%20is%20redrawn,%20per%20second%0D%0Alet%20refreshRate%20=%208;%0D%0A%0D%0A//%20Boolean%20indicating%20whether%20the%20game%20is%20currently%20in%20progress%0D%0Alet%20gameHasStarted%20=%20false;%0D%0A%0D%0A//%20Define%20the%20function%20to%20be%20called%20when%20the%20window%20loads%0D%0Awindow.onload%20=%20function%20()%20%7B%0D%0A%0D%0A%20%20%20%20//%20Set%20up%20the%20graphics%0D%0A%20%20%09gc.width%20=%20tileCount%20*%20gridSize;%0D%0A%20%20%09gc.height%20=%20tileCount%20*%20gridSize;%0D%0A%20%20%20%20ctx%20=%20gc.getContext('2d');%0D%0A%09%0D%0A%20%20%20%20//%20Draw%20the%20opening%20screen%0D%0A%20%20%20%20drawStartingScreen();%0D%0A%20%20%0D%0A%20%20%09//%20Add%20listener%20for%20key%20presses%0D%0A%20%20%20%20document.addEventListener('keydown',%20keyPush);%0D%0A%20%20%09playButton.addEventListener('click',%20startGame);%0D%0A%0D%0A%7D;%0D%0A%0D%0A//%20Function:%20starting%20the%20game%20(canvas%20starts%20to%20refresh)%0D%0Afunction%20startGame()%20%7B%0D%0A%0D%0A%20%20%20%20gameHasStarted%20=%20true;%0D%0A%0D%0A%20%20%20%20//%20Create%20how%20many%20snakes%20you%20want%0D%0A%20%20%20%20createSnakes();%0D%0A%0D%0A%20%20%20%20//%20Randomize%20the%20location%20of%20the%20starting%20apple%0D%0A%20%20%20%20spawnNewApple();%0D%0A%0D%0A%20%20%20%20//%20Start%20the%20graphics,%20at%20a%2015%20refreshes%20per%20second%20rate%0D%0A%20%20%20%20window.refresher%20=%20setInterval(refreshGame,%201000%20/%20refreshRate);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20createSnakes()%20%7B%0D%0A%0D%0A%20%20%20%20snakes%20=%20%5B%5D;%0D%0A%0D%0A%20%20%20%20const%20snake1%20=%20new%20Snake(1,%209,%20'green');%0D%0A%20%20%20%20snakes.push(snake1);%0D%0A%0D%0A%7D%0D%0A%0D%0A//%20Function:%20called%20multiple%20times%20a%20second%20to%20refresh%20the%20canvas%0D%0Afunction%20refreshGame()%20%7B%0D%0A%0D%0A%20%20%20%20clearCanvas();%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20apple%0D%0A%20%20%20%20apple.draw(ctx);%0D%0A%0D%0A%20%20%20%20refreshSnakes();%0D%0A%0D%0A%20%20%20%20//%20Check%20if%20snakes%20have%20run%20into%20each%20other%0D%0A%20%20%20%20checkForSnakeCollision();%0D%0A%0D%0A%20%20%20%20updatePointsLabel();%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20refreshSnakes()%20%7B%0D%0A%0D%0A%20%20%20%20//%20If%20any%20snake%20draw%20fails,%20stop%20all%20drawing%0D%0A%20%20%20%20snakes.every(snake%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20if%20(snake.draw(ctx))%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20snake.checkForApple();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%0D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%7D);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20checkForSnakeCollision()%20%7B%0D%0A%0D%0A%20%20%20%20let%20losingSnakes%20=%20%5B%5D;%0D%0A%20%20%20%20snakes.forEach(snake%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20if%20(snake.checkForSnakeCollision())%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20losingSnakes.push(snake);%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20if%20(losingSnakes.length)%20%7B%0D%0A%20%20%20%20%20%20%20%20playerLoses(losingSnakes);%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D%0D%0A%0D%0A//%20Function:%20resetting%20the%20game%20(if%20the%20player%20dies)%0D%0Afunction%20resetGame()%20%7B%0D%0A%0D%0A%20%20%20%20player1Name%20=%20null;%0D%0A%20%20%20%20player2Name%20=%20null;%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20starting%20snake%20screen%0D%0A%20%20%20%20drawStartingScreen();%0D%0A%0D%0A%20%20%20%20updatePointsLabel();%0D%0A%7D%0D%0A%0D%0A//%20Function:%20handles%20the%20playing-losing%20event%0D%0Afunction%20playerLoses(losingSnakes)%20%7B%0D%0A%0D%0A%20%20%20%20gameHasStarted%20=%20false;%0D%0A%0D%0A%20%20%20%20//%20Stop%20the%20canvas%20from%20refreshing%0D%0A%20%20%20%20clearInterval(window.refresher);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20screen%20showing%20the%20%22L%22%20snake%0D%0A%20%20%20%20drawLosingScreen();%0D%0A%0D%0A%20%20%20%20//%20Wait%203%20seconds,%20and%20then%20reset%20the%20game%0D%0A%20%20%20%20setTimeout(resetGame,%203000);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20spawnNewApple()%20%7B%0D%0A%20%20%20%20apple%20=%20new%20Apple();%0D%0A%7D%0D%0A%0D%0Afunction%20clearCanvas()%20%7B%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(0,%200,%20gc.width,%20gc.height);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20updatePointsLabel()%20%7B%0D%0A%20%20%20%20pointsLabel.innerHTML%20=%20gameHasStarted%20?%20'Points:%20'%20+%20String(snakes%5B0%5D.points)%20:%20'Points:%200';%0D%0A%7D%0D%0A%0D%0Afunction%20keyPush(evt)%20%7B%0D%0A%20%20%20%20%0D%0A%20%20%20%20if%20(!gameHasStarted)%20%7B%0D%0A%20%20%20%20%20%20%20%20return;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20evt.preventDefault();%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2065)%20snakes%5B0%5D.setDirection(Direction.left);%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2087)%20snakes%5B0%5D.setDirection(Direction.up);%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2068)%20snakes%5B0%5D.setDirection(Direction.right);%0D%0A%0D%0A%20%20%20%20if%20(evt.keyCode%20===%2083)%20snakes%5B0%5D.setDirection(Direction.down);%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20drawLosingScreen()%20%7B%0D%0A%0D%0A%20%20%20%20clearCanvas();%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(0,%200,%20gc.width,%20gc.height);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'green';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize,%203%20*%20gridSize,%208%20*%20gridSize,%2014%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(8%20*%20gridSize,%203%20*%20gridSize,%206%20*%20gridSize,%2012%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20triangle%20tail%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(13%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(13%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20eyes%0D%0A%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%203%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%20%20%20%20ctx.fillRect(7%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%203%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20tongue%0D%0A%20%20%20%20ctx.fillStyle%20=%20'pink';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize%20+%205%20/%206%20*%20gridSize,%202.5%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%202%20*%20gridSize);%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7%20*%20gridSize,%202%20*%20gridSize%20+%203%20/%208%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6.5%20*%20gridSize,%202%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize%20+%205%20/%206%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7%20*%20gridSize,%202%20*%20gridSize%20+%203%20/%208%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7.5%20*%20gridSize,%202%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(7%20*%20gridSize%20+%201%20/%206%20*%20gridSize,%202.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%7D%0D%0A%0D%0Afunction%20drawStartingScreen()%20%7B%0D%0A%0D%0A%20%20%20%20clearCanvas();%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(0,%200,%20gc.width,%20gc.height);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'green';%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize,%203%20*%20gridSize,%208%20*%20gridSize,%2014%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20ctx.fillStyle%20=%20'black';%0D%0A%20%20%20%20ctx.fillRect(8%20*%20gridSize,%205%20*%20gridSize,%206%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.fillRect(6%20*%20gridSize,%2011%20*%20gridSize,%206%20*%20gridSize,%204%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20triangle%20tail%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2015%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(7%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2016%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(6%20*%20gridSize,%2017%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20eyes%0D%0A%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20ctx.fillRect(13%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%203%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%20%20%20%20ctx.fillRect(13%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%204%20*%20gridSize%20+%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%0D%0A%20%20%20%20//%20Draw%20the%20tongue%0D%0A%20%20%20%20ctx.fillStyle%20=%20'pink';%0D%0A%20%20%20%20ctx.fillRect(14%20*%20gridSize,%203%20*%20gridSize%20+%205%20/%206%20*%20gridSize,%201%20/%202%20*%20gridSize,%201%20/%203%20*%20gridSize);%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(14.5%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize%20+%205%20/%208%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(15%20*%20gridSize,%203.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14.5%20*%20gridSize,%203%20*%20gridSize%20+%205%20/%206%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20ctx.moveTo(14.5%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14%20*%20gridSize%20+%205%20/%208%20*%20gridSize,%204%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(15%20*%20gridSize,%204.5%20*%20gridSize);%0D%0A%20%20%20%20ctx.lineTo(14.5%20*%20gridSize,%204%20*%20gridSize%20+%201%20/%206%20*%20gridSize);%0D%0A%20%20%20%20ctx.fill();%0D%0A%0D%0A%7D%0D%0A%0D%0Aclass%20Snake%20%7B%0D%0A%0D%0A%20%20%20%20constructor(x,%20y,%20color,%20name%20=%20'Snakey')%20%7B%0D%0A%20%20%20%20%20%20%20%20//%20An%20array%20of%20SnakeSegments%0D%0A%20%20%20%20%20%20%20%20this.segments%20=%20%5B%5D;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.color%20=%20color;%0D%0A%20%20%20%20%20%20%20%20this.altColor%20=%20color;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.name%20=%20name;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.direction%20=%20Direction.up;%0D%0A%20%20%20%20%20%20%20%20this.pendingTurn%20=%20false;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Coordinates%20of%20the%20head%20of%20the%20snake%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20x;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.prevTailPos%20=%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20x:%200,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20y:%200%0D%0A%20%20%20%20%20%20%20%20%7D;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.points%20=%200;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.generateSnake();%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20generateSnake()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Create%20the%20initial%20snake%0D%0A%20%20%20%20%20%20%20%20const%20startSize%20=%205;%0D%0A%20%20%20%20%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%20startSize;%20i++)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20segment;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!i)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20segment%20=%20new%20SnakeSegment(this.x,%20this.y,%20this.color,%20SegmentType.head);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(i%20===%20startSize%20-%201)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20segment%20=%20new%20SnakeSegment(this.x,%20this.y,%20this.color,%20SegmentType.tail);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20segment%20=%20new%20SnakeSegment(this.x,%20this.y,%20this.color,%20SegmentType.body);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.segments.push(segment);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20drawSnakeTail()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20tail%20=%20this.tail;%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20preTail%20=%20this.getSegment(this.segments.length%20-%202);%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Get%20the%20direction%20that%20the%20tail%20is%20moving%20in%0D%0A%20%20%20%20%20%20%20%20let%20tailXVelocity%20=%20preTail.position.x%20-%20tail.position.x;%0D%0A%20%20%20%20%20%20%20%20let%20tailYVelocity%20=%20preTail.position.y%20-%20tail.position.y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20switch%20(tailXVelocity)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize%20+%209);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize%20+%209);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%200:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(tailYVelocity)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%209,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.moveTo(tail.position.x%20*%20gridSize,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%2018,%20tail.position.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.lineTo(tail.position.x%20*%20gridSize%20+%209,%20tail.position.y%20*%20gridSize%20+%2018);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20drawSnakeEyes()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20head%20=%20this.head;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Giving%20the%20snake%20eyes%20based%20off%20of%20its%20direction%0D%0A%20%20%20%20%20%20%20%20switch%20(this.direction.x)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2012,%20head.position.y%20*%20gridSize%20+%203,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2012,%20head.position.y%20*%20gridSize%20+%2011,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%202,%20head.position.y%20*%20gridSize%20+%203,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%202,%20head.position.y%20*%20gridSize%20+%2011,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%200:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(this.direction.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%203,%20head.position.y%20*%20gridSize%20+%2012,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2011,%20head.position.y%20*%20gridSize%20+%2012,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20-1:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'white';%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%203,%20head.position.y%20*%20gridSize%20+%202,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(head.position.x%20*%20gridSize%20+%2011,%20head.position.y%20*%20gridSize%20+%202,%204,%204);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20this.color;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20//%20Called%20to%20draw%20the%20entire%20snake%0D%0A%20%20%20%20draw(ctx)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20this.color;%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20success%20=%20this.updatePositions();%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(!success)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%20this.segments.length;%20i++)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20drawing%20the%20tail%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20==%20this.segments.length%20-%201)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.drawSnakeTail();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillRect(this.segments%5Bi%5D.x%20*%20gridSize,%20this.segments%5Bi%5D.y%20*%20gridSize,%20gridSize%20-%202,%20gridSize%20-%202);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20drawing%20the%20head%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!i)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.drawSnakeEyes();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20return%20true;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20updatePositions()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.pendingTurn%20=%20false;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Expressions%20account%20for%20vertical%20and%20horizontal%20wrapping%0D%0A%20%20%20%20%20%20%20%20const%20newX%20=%20this.x%20+%20this.direction.x%20%3E%20tileCount%20-%201%20?%200%20:%20(this.x%20+%20this.direction.x%20%3C%200%20?%20tileCount%20-%201%20:%20this.x%20+%20this.direction.x);%0D%0A%20%20%20%20%20%20%20%20const%20newY%20=%20this.y%20+%20this.direction.y%20%3E%20tileCount%20-%201%20?%200%20:%20(this.y%20+%20this.direction.y%20%3C%200%20?%20tileCount%20-%201%20:%20this.y%20+%20this.direction.y);%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20newX;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20newY;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Check%20if%20the%20snake%20ran%20into%20an%20obstacle%0D%0A%20%20%20%20%20%20%20%20const%20collision%20=%20obstacles.some(obstacle%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20obstacle.isCollision(this.x,%20this.y);%0D%0A%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(collision)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20playerLoses(%5Bthis%5D);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Go%20through%20the%20segments%20from%20the%20tail%20to%20the%20head,%20assigning%20each%20segment's%20x%20and%20y%20equal%20to%20the%20next%20segment's%20position%0D%0A%20%20%20%20%20%20%20%20for%20(let%20i%20=%20this.segments.length%20-%201;%20i%20%3E=%200;%20i--)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!i)%20%7B%20//%20For%20the%20head%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.segments%5Bi%5D.setPosition(this.x,%20this.y);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20===%20this.segments.length%20-%201)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.prevTailPos%20=%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x:%20this.segments%5Bi%5D.x,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y:%20this.segments%5Bi%5D.y%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20nextX%20=%20this.segments%5Bi%20-%201%5D.x;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20nextY%20=%20this.segments%5Bi%20-%201%5D.y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(nextX%20===%20this.x%20&&%20nextY%20===%20this.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20playerLoses(this);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.segments%5Bi%5D.setPosition(nextX,%20nextY);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20return%20true;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20checkForApple()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(this.x%20===%20apple.position.x%20&&%20this.y%20===%20apple.position.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%09this.points++;%0D%0A%20%20%20%20%20%20%20%20%20%20%09this.addSegment();%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20spawnNewApple();%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20//%20Checks%20if%20this%20snake%20has%20run%20into%20any%20other%20snake%0D%0A%20%20%20%20checkForSnakeCollision()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20return%20snakes.some(snake%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(snake%20!==%20this)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20snake.segments.some(segment%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(segment.position.x%20===%20this.x%20&&%20segment.position.y%20===%20this.y)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20addSegment()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20tailSegment%20=%20this.segments%5Bthis.segments.length%20-%201%5D;%0D%0A%0D%0A%20%20%20%20%20%20%20%20const%20newSegment%20=%20new%20SnakeSegment(tailSegment.position.x,%20tailSegment.position.y,%20this.color,%20SegmentType.body);%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.segments.splice(this.segments.length%20-%201,%200,%20newSegment);%0D%0A%0D%0A%20%20%20%20%20%20%20%20tailSegment.setPosition(this.prevTailPos.x,%20this.prevTailPos.y);%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20setDirection(direction)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20if%20(this.pendingTurn)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20return;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.pendingTurn%20=%20true;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20To%20prevent%20180%20degree%20turns%0D%0A%20%20%20%20%20%20%20%20switch%20(direction)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.up:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.down)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.down:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.up)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.left:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.right)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20Direction.right:%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.direction%20===%20Direction.left)%20return%20false;%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.direction%20=%20direction;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20head()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20this.segments%5B0%5D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20tail()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20this.segments%5Bthis.segments.length%20-%201%5D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20getSegment(i)%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20this.segments%5Bi%5D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D%0D%0A%0D%0Aclass%20SnakeSegment%20%7B%0D%0A%0D%0A%20%20%20%20constructor(x,%20y,%20color,%20type)%20%7B%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20x;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20y;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.color%20=%20color;%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20SegmentType%0D%0A%20%20%20%20%20%20%20%20this.type%20=%20type;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20setPosition(x,%20y)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.x%20=%20x;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%20y;%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20position()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20x:%20this.x,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20y:%20this.y%0D%0A%20%20%20%20%20%20%20%20%7D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D%0D%0A%0D%0Aclass%20Apple%20%7B%0D%0A%0D%0A%20%20%20%20constructor()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.x%20=%200;%0D%0A%20%20%20%20%20%20%20%20this.y%20=%200;%0D%0A%0D%0A%20%20%20%20%20%20%20%20this.initPosition();%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20initPosition()%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20let%20collision%20=%20false;%0D%0A%20%20%20%20%20%20%20%20do%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.x%20=%20Math.floor(Math.random()%20*%20tileCount);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20this.y%20=%20Math.floor(Math.random()%20*%20tileCount);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20collision%20=%20obstacles.some(obstacle%20=%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obstacle.isCollision(this.x,%20this.y);%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D);%0D%0A%0D%0A%20%20%20%20%20%20%20%20%7D%20while%20(collision);%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20draw(ctx)%20%7B%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Draw%20apple%0D%0A%20%20%20%20%20%20%20%20if%20(this.gold)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'gold';%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'red';%0D%0A%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20ctx.arc(this.x%20*%20gridSize%20+%200.5%20*%20(gridSize%20-%202),%20this.y%20*%20gridSize%20+%200.5%20*%20(gridSize%20-%202),%200.4%20*%20(gridSize%20-%202),%200,%202%20*%20Math.PI);%0D%0A%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Draw%20stem%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'brown';%0D%0A%20%20%20%20%20%20%20%20ctx.fillRect(this.x%20*%20gridSize%20+%207,%20this.y%20*%20gridSize,%204,%200.5%20*%20(gridSize%20-%202));%0D%0A%0D%0A%20%20%20%20%20%20%20%20//%20Draw%20leaf%0D%0A%20%20%20%20%20%20%20%20ctx.fillStyle%20=%20'green';%0D%0A%20%20%20%20%20%20%20%20ctx.beginPath();%0D%0A%20%20%20%20%20%20%20%20ctx.moveTo(this.x%20*%20gridSize%20+%209,%20this.y%20*%20gridSize);%0D%0A%20%20%20%20%20%20%20%20ctx.lineTo(this.x%20*%20gridSize%20+%209,%20this.y%20*%20gridSize%20+%204);%0D%0A%20%20%20%20%20%20%20%20ctx.lineTo(this.x%20*%20gridSize%20+%2018,%20this.y%20*%20gridSize%20+%202);%0D%0A%20%20%20%20%20%20%20%20ctx.fill();%0D%0A%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20get%20position()%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20x:%20this.x,%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20y:%20this.y%0D%0A%20%20%20%20%20%20%20%20%7D;%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%7D#BEGIN_EDITABLE##END_EDITABLE###JS_E####CODE_2E####LOGIC_2####HTML####HTML_E####CSS####CSS_E####JS####JS_E####LOGIC_2E####STEP_2E####STEP_3####INST_3####INST_3E####CODE_3####HTML##%3C!DOCTYPE%20html%3E%0D%0A%3Chtml%3E%0D%0A%0D%0A%3Chead%3E%0D%0A%20%20%20%20%3Clink%20rel=%22stylesheet%22%20href=%22style.css%22%20/%3E%0D%0A%20%20%20%20%3Clink%20href=%22https://fonts.googleapis.com/css?family=Nunito:200,400,700%22%20rel=%22stylesheet%22%3E%0D%0A%20%20%20%20%3Cscript%20src=%22script.js%22%3E%3C/script%3E%0D%0A%3C/head%3E%0D%0A%0D%0A%3Cbody%3E%0D%0A%0D%0A%20%20%20%20%3Ccanvas%20id='gc'%3E%3C/canvas%3E%0D%0A%0D%0A%20%20%20%20%0D%0A%3C/body%3E%0D%0A%0D%0A%3C/html%3E#BEGIN_EDITABLE##END_EDITABLE###HTML_E####CSS####CSS_E####JS##ctx%20=%20gc.getContext('2d');%0A%0Actx.beginPath();%0Actx.arc(75,75,50,0,Math.PI*2);%20//%20Outer%20circle%0A//%20%20ctx.moveTo(110,75);%0Actx.arc(75,75,35,0,Math.PI);%20//%20Mouth%20(clockwise)%0A//%20%20ctx.moveTo(65,65);%0Actx.arc(60,65,5,0,Math.PI*2);%20//%20Left%20eye%0A//%20%20ctx.moveTo(95,65);%0Actx.arc(90,65,5,0,Math.PI*2);%20//%20Right%20eye%0Actx.stroke();##JS_E####CODE_3E####LOGIC_3####HTML####HTML_E####CSS####CSS_E####JS####JS_E####LOGIC_3E####STEP_3E##